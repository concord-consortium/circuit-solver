(function(){var e=function(){this.components=[];this.nodeMap={};this.nodes=[];this.voltageSources=[];this.currentSources=[];this.AMatrix=[];this.ZMatrix=[];this.referenceNode=null;this.referenceNodeIndex=null;this.frequency=[];this.maxInputFrequency=null;this.time=0;this.maxResistance=10;this.minResistance=100000;this.maxCapacitance=1e-8;this.minCapacitance=0.0001;this.maxInductance=0.01;this.minInductance=100;this.RLC=true;this.RLCD=true};e.prototype.getLinkedComponents=function(g){return this.nodeMap[g]};e.prototype.getDiagonalMatrixElement=function(l,m){var n=this.nodeMap[l],g=$Comp(0,0),k,h;for(h=n.length-1;h>=0;h--){k=n[h].getImpedance(m);g=g.add(k.inverse())}return g};e.prototype.getNodeIndexes=function(h){var g=[];g[0]=this.getNodeIndex(h.nodes[0]);g[1]=this.getNodeIndex(h.nodes[1]);return g};e.prototype.getNodeIndex=function(h){var g=this.nodes.indexOf(h);if(g===this.referenceNodeIndex){return -1}if(g>this.referenceNodeIndex){return g-1}return g};var c=function(h,o,q,g,p,k,m,n,r,l,i){this.id=h;this.type=o;this.value=q;this.nodes=g;if(o==="Diode"){this.dark_current=p;this.bias=true;this.value=1;this.value_reverse=-10/(p*(Math.exp(-40*10)-1))}if(o==="MOSFET"){this.value=10;this.value_reverse=100000}if(o==="Capacitor"){this.charge=0;this.voltage_source=null}if(o==="Inductor"){this.flux=0;this.current_source=null}};var d=2*Math.PI;var f=[];c.prototype.getImpedance=function(){var g=$Comp(0,0);if(this.type==="Resistor"){g.real=this.value;g.imag=0}else{if(this.type=="Capacitor"){g.real=0;g.imag=0}else{if(this.type=="Inductor"){g.real=0;g.imag=0}else{if(this.type=="Diode"){g.real=this.value;g.imag=0}}}}return g};c.prototype.getOffDiagonalMatrixElement=function(g){return this.getImpedance(g).inverse().negative()};var b=function(m,k,h,g,i,l){this.id=m;this.Voltage=k;this.positiveNode=h;this.negativeNode=g;this.frequency=i||0;this.array=l};var a=function(m,i,h,g,k,l){this.id=m;this.Current=i;this.positiveNode=h;this.negativeNode=g;this.frequency=k||0;this.array=l};e.prototype.addComponent=function(x,h,B,w,y,z,n,C,l,r,J){var t=new c(x,h,B,w,y,z,n,C,l,r,J),E,u,D;if(h==="Resistor"){if(B>=this.maxResistance){this.maxResistance=B}if(B<=this.minResistance){this.minResistance=B}}else{if(h==="Capacitor"){if(B>=this.maxCapacitance){this.maxCapacitance=B}if(B<=this.minCapacitance){this.minCapacitance=B}C=0;var H=new c((x+"_res"),"Resistor",0,[w[0],w[1]],y,z,n,C,l,r,J);var A=new b(x+"VoltageSource",C/B,w[0],w[1],Math.abs(Math.max.apply(Math,this.frequency)));r=A;this.voltageSources.push(A);var G=w[0];var I=w[1];if(!this.nodeMap[G]){this.nodeMap[G]=[];this.nodes.push(G)}if(!this.nodeMap[I]){this.nodeMap[I]=[];this.nodes.push(I)}this.nodeMap[G].push(H);this.nodeMap[I].push(H)}else{if(h==="Inductor"){if(B>=this.maxInductance){this.maxInductance=B}if(B<=this.minInductance){this.minInductance=B}l=0;var v=new c((x+"_res"),"Resistor",0,[w[0],w[1]],y,z,n,C,l,r,J);var A=new a(x+"CurrentSource",l/B,w[0],w[1],Math.abs(Math.max.apply(Math,this.frequency)));J=A;this.currentSources.push(A);var G=w[0];var I=w[1];if(!this.nodeMap[G]){this.nodeMap[G]=[];this.nodes.push(G)}if(!this.nodeMap[I]){this.nodeMap[I]=[];this.nodes.push(I)}this.nodeMap[G].push(v);this.nodeMap[I].push(v)}else{if(h==="MOSFET"){this.RLC=false;this.RLCD=false;var o=new c((x+"_res"),"MOSFET",100,[w[0],w[2]],y,z,n,C,l,r,J);var A=new a(x+"CurrentSource",0,w[0],w[2],Math.max.apply(Math,this.frequency));J=A;this.currentSources.push(A);var s=w[0];var g=w[1];var F=w[2];if(!this.nodeMap[s]){this.nodeMap[s]=[];this.nodes.push(s)}if(!this.nodeMap[g]){this.nodeMap[g]=[];this.nodes.push(g)}if(!this.nodeMap[F]){this.nodeMap[F]=[];this.nodes.push(F)}this.nodeMap[F].push(o);this.nodeMap[g].push(o);this.nodeMap[s].push(o)}else{if(h==="Diode"){this.RLC=false}}}}}if(h==="Transistor"){this.RLC=false;this.RLCD=false;var q=[w[1],w[0]];var p=[w[1],w[2]];var m=new c((x+"1"),"Diode",B,q,y,z,n,C,l,r,J);var k=new c((x+"2"),"Diode",B,p,y,z,n,C,l,r,J);this.components.push(m);this.components.push(k);for(E=0,u=q.length;E<u;E++){D=q[E];if(!this.nodeMap[D]){this.nodeMap[D]=[];this.nodes.push(D)}this.nodeMap[D].push(m)}for(E=0,u=p.length;E<u;E++){D=p[E];if(!this.nodeMap[D]){this.nodeMap[D]=[];this.nodes.push(D)}this.nodeMap[D].push(k)}var A=new a(x+"2CurrentSource_CB",0,w[1],w[0],Math.max.apply(Math,this.frequency));J=A;this.currentSources.push(A);A=new a(x+"1CurrentSource_CE",0,w[1],w[2],Math.max.apply(Math,this.frequency));J=A;this.currentSources.push(A)}else{t=new c(x,h,B,w,y,z,n,C,l,r,J);this.components.push(t);for(E=0,u=w.length;E<u;E++){D=w[E];if(!this.nodeMap[D]){this.nodeMap[D]=[];this.nodes.push(D)}this.nodeMap[D].push(t)}}};e.prototype.addVoltageSource=function(n,l,h,g,k,m){this.frequency.push(k);if(k>this.maxInputFrequency){this.maxInputFrequency=k}var i=new b(n,l,h,g,this.frequency[this.frequency.length-1],m);this.voltageSources.push(i);if(!this.nodeMap[h]){this.nodeMap[h]=[];this.nodes.push(h)}if(!this.nodeMap[g]){this.nodeMap[g]=[];this.nodes.push(g)}if(!this.referenceNode&&this.frequency.length==1){this.setReferenceNode(g)}};e.prototype.addCurrentSource=function(n,i,h,g,l,m){this.frequency.push(l);if(l>this.maxInputFrequency){this.maxInputFrequency=l}var k=new a(n,i,h,g,this.frequency[this.frequency.length-1],m);this.currentSources.push(k);if(!this.nodeMap[h]){this.nodeMap[h]=[];this.nodes.push(h)}if(!this.nodeMap[g]){this.nodeMap[g]=[];this.nodes.push(g)}if(!this.referenceNode&&this.frequency.length==1){this.setReferenceNode(g)}};e.prototype.setReferenceNode=function(g){this.referenceNode=g;this.referenceNodeIndex=this.nodes.indexOf(g)};e.prototype.createAMatrix=function(){this.createEmptyAMatrix();this.addGMatrix();this.addBCMatrix()};e.prototype.createEmptyAMatrix=function(){var h=$Comp(0,0),m=this.nodes.length,l=this.voltageSources.length,n=m-1+l,k,g;this.AMatrix=[];for(k=0;k<n;k++){this.AMatrix[k]=[];for(g=0;g<n;g++){this.AMatrix[k][g]=h.copy()}}};e.prototype.addGMatrix=function(){var n,o,l,k,m,h,p,g;if(this.voltageSources.length>0){n=this.voltageSources[0];o=n.frequency}else{if(this.currentSources.length>0){n=this.currentSources[0];o=n.frequency}}for(l=0;l<this.nodes.length;l++){m=this.nodes[l];if(m===this.referenceNode){continue}h=this.getNodeIndex(m);this.AMatrix[h][h]=this.getDiagonalMatrixElement(m,o)}for(l=0;l<this.components.length;l++){p=this.getNodeIndexes(this.components[l])[0];g=this.getNodeIndexes(this.components[l])[1];if(p===-1||g===-1){continue}this.AMatrix[p][g]=this.AMatrix[g][p]=this.AMatrix[p][g].add(this.components[l].getOffDiagonalMatrixElement(o))}};e.prototype.addBCMatrix=function(){if(this.voltageSources.length===0&&this.currentSources.length===0){return}var k=$Comp(1,0),p=k.negative(),g=this.voltageSources,m,n,l,o,h;for(h=0;h<g.length;h++){m=g[h];n=m.positiveNode;if(n!==this.referenceNode){o=this.getNodeIndex(n);this.AMatrix[this.nodes.length-1+h][o]=k.copy();this.AMatrix[o][this.nodes.length-1+h]=k.copy()}l=m.negativeNode;if(l!==this.referenceNode){o=this.getNodeIndex(l);this.AMatrix[this.nodes.length-1+h][o]=p.copy();this.AMatrix[o][this.nodes.length-1+h]=p.copy()}}};e.prototype.createZMatrix=function(n){var h=$Comp(0,0),m=this.nodes.length,l=this.voltageSources.length;numSources=this.voltageSources.length+this.currentSources.length,arraySize=m-1+l,sources=this.voltageSources;var k,g;var o;this.ZMatrix=[[]];for(k=0;k<arraySize;k++){this.ZMatrix[0][k]=h.copy()}if(n>=0){for(k=0;k<sources.length;k++){if(sources[k].frequency>=0){this.ZMatrix[0][m-1+k].real=(sources[k].Voltage*Math.sin(d*sources[k].frequency*n))}else{if(-1*n*sources[k].frequency<=sources[k].array.length){this.ZMatrix[0][m-1+k].real=(sources[k].array[-1*Math.ceil(n*sources[k].frequency)])}else{this.ZMatrix[0][m-1+k].real=sources[k].Voltage}}}}sources=this.currentSources;for(k=0;k<sources.length;k++){source=sources[k];posNode=source.positiveNode;if(posNode!==this.referenceNode){o=this.getNodeIndex(posNode);if(n>=0){if(sources[k].frequency>=0){this.ZMatrix[0][o].real=(sources[k].Current*Math.sin(d*sources[k].frequency*n))}else{if(-1*n*sources[k].frequency<=sources[k].array.length){this.ZMatrix[0][o].real=(sources[k].array[-1*Math.ceil(n*sources[k].frequency)])}else{this.ZMatrix[0][o].real=sources[k].Current}}}}else{o=this.getNodeIndex(negNode);if(n>=0){if(sources[k].frequency>=0){this.ZMatrix[0][o].real=-1*(sources[k].Current*Math.sin(d*sources[k].frequency*n))}else{if(-1*n*sources[k].frequency<=sources[k].array.length){this.ZMatrix[0][o].real=-1*(sources[k].array[-1*Math.ceil(n*sources[k].frequency)])}else{this.ZMatrix[0][o].real=-1*sources[k].Current}}}}}};e.prototype.cleanCircuit=function(){var h=this.nodes,s=this.nodeMap,o=this.components,t,q=this.referenceNode,u=[],g,k,l,v;function r(w){var y=[];for(var x in w){y[x]=w[x]}return y}s=r(s);function m(w){var z=[];for(var x=0,y=w.length;x<y;x++){if(w[x]!==null){z.push(w[x])}}return z}function p(x,D){var z=D[x],E,y,F=[],w,B,G,A,C;if(x===q){return true}if(~u.indexOf(x)){return true}if(!z||z.length===0){return false}delete D[x];for(B=0,G=z.length;B<G;B++){E=z[B];y=r(E.nodes);y.splice(y.indexOf(x),1);F=F.concat(y)}for(A=0,C=F.length;A<C;A++){if(p(F[A],D)){u.push(x);return true}}return false}for(l=0,v=h.length;l<v;l++){k=h[l];if(k){if(!p(k,s)){h[l]=null}}}this.nodes=m(h);s=this.nodeMap;function n(w,A){var z=r(s[A]),x,y;s[A]=[];for(x=0,y=z.length;x<y;x++){if(z[x].id!==w.id){s[A].push(z[x])}}}if(this.RLCD){for(l=0,v=o.length;l<v;l++){t=o[l];if(!(~h.indexOf(t.nodes[0])&&~h.indexOf(t.nodes[1]))){n(t,t.nodes[0]);n(t,t.nodes[1]);o[l]=null}}}this.components=m(o);for(l=0,v=this.voltageSources.length;l<v;l++){g=this.voltageSources[l];if(!(~h.indexOf(g.positiveNode)&&~h.indexOf(g.negativeNode))){this.voltageSources[l]=null}}this.voltageSources=m(this.voltageSources);for(l=0,v=this.currentSources.length;l<v;l++){g=this.currentSources[l];if(!(~h.indexOf(g.positiveNode)&&~h.indexOf(g.negativeNode))){this.currentSources[l]=null}}this.currentSources=m(this.currentSources);this.referenceNodeIndex=this.nodes.indexOf(q)};e.prototype.solve_RLC=function(){this.cleanCircuit();this.createAMatrix();this.createZMatrix();aM=$M(this.AMatrix);zM=$M(this.ZMatrix);invAM=aM.inv();res=zM.x(invAM);return res};e.prototype.solve=function(r){components=this.components;v=this.voltageSources;l=this.currentSources;var B=Math.max.apply(Math,this.frequency);B=Math.max(B,(1/this.minResistance)/this.minCapacitance,this.maxResistance/this.minInductance,Math.sqrt((1/this.minInductance)/this.minCapacitance),1000);var L=[];var w=0;this.cleanCircuit();this.createAMatrix();this.createZMatrix(w);aM=$M(this.AMatrix);zM=$M(this.ZMatrix);invAM=aM.inv();var s=zM.x(invAM);var I,M,H,m;while(w<=r){this.time=w;this.cleanCircuit();this.createAMatrix();this.createZMatrix(w);aM=$M(this.AMatrix);zM=$M(this.ZMatrix);invAM=aM.inv();res=zM.x(invAM);var O=true,u=true,J,y,N;while(O===true){O=false;for(J=0,y=components.length;J<y;J++){var x=components[J];var E=x.nodes;var h=E[0];var g=E[1];var q=this.getNodeIndex(h);var p=this.getNodeIndex(g);var F=x.value;var D=x.value_reverse;if(x.type==="Capacitor"){if(w===0){x.charge=0}else{var v=this.voltageSources;var n=null;var o=null;for(I=0,M=v.length;I<M;I++){if(v[I].id==x.id+"VoltageSource"){n=I;break}}o=s.elements[0][this.nodes.length-1+n];x.charge=x.charge+0.001*0.5*o.real/Math.abs(this.maxInputFrequency);v[n].Voltage=x.charge/F}}else{if(x.type==="Inductor"){if(w===0){x.flux=0}else{var l=this.currentSources;var n=null;var z=null;for(I=0,M=l.length;I<M;I++){if(l[I].id==x.id+"CurrentSource"){n=I;break}}if(q!=-1&&p!=-1){z=s.elements[0][q]-s.elements[0][p]}else{if(q===-1){z=-s.elements[0][p]}else{z=s.elements[0][q]}}x.flux=x.flux-0.001*0.5*z.real/Math.abs(this.maxInputFrequency);l[n].Current=x.flux/F}}else{if(x.type==="MOSFET"){var l=this.currentSources;var n=null;if(p!=-1){var K=s.elements[0][p].real}else{var K=0}if(q!=-1){var G=s.elements[0][q].real}else{var G=0}if(this.getNodeIndex(E[2])!=-1){var A=s.elements[0][this.getNodeIndex(E[2])].real}else{var A=0}for(I=0,M=l.length;I<M;I++){if(l[I].id==x.id+"CurrentSource"){n=I;break}}if(K-A<0.7){l[n].Current=0}else{if(G<K-0.7){l[n].Current=0.01*(K-0.5*A-0.5*G-0.7)*(G-A)}else{l[n].Current=0.01*0.5*(K-A-0.7)*(K-A-0.7)}}}}}if(x.type==="Diode"){var l=this.currentSources;var n=null;var t=2;for(I=0,M=l.length;I<M;I++){if(l[I].id==x.id+"CurrentSource_CB"){t=0;n=I;break}else{if(l[I].id==x.id+"CurrentSource_CE"){t=1;n=I;break}}}if(t!=2){if(q!=-1&&p!=-1){if(((res.elements[0][q]).real-(res.elements[0][p]).real<0&&(F<D))||((res.elements[0][q]).real-(res.elements[0][p]).real>0&&(F>D))){if(t){l[n].Current=0.02*((res.elements[0][q]).real-(res.elements[0][p]).real)/D}else{l[n].Current=0.98*((res.elements[0][q]).real-(res.elements[0][p]).real)/D}}else{if(t){l[n].Current=0.02*((res.elements[0][q]).real-(res.elements[0][p]).real)/F}else{l[n].Current=0.98*((res.elements[0][q]).real-(res.elements[0][p]).real)/F}}}else{if(q===-1){if((-(res.elements[0][p]).real<0&&(F<D))||(-(res.elements[0][p]).real>0&&(F>D))){if(t){l[n].Current=0.02*-(res.elements[0][p]).real/D}else{l[n].Current=0.98*-(res.elements[0][p]).real/D}}else{if(t){l[n].Current=0.02*-(res.elements[0][p]).real/F}else{l[n].Current=0.98*-(res.elements[0][p]).real/F}}}else{if(p===-1){if(((res.elements[0][q]).real<0&&(F<D))||((res.elements[0][q]).real>0&&(F>D))){if(t){l[n].Current=0.02*(res.elements[0][q]).real/D}else{l[n].Current=0.98*(res.elements[0][q]).real/D}}else{if(t){l[n].Current=0.02*(res.elements[0][q]).real/F}else{l[n].Current=0.98*(res.elements[0][q]).real/F}}}}}}if(q!=-1&&p!=-1){if(((res.elements[0][q]).real-(res.elements[0][p]).real<0&&(F<D))||((res.elements[0][q]).real-(res.elements[0][p]).real>0&&(F>D))){N=D;D=F;F=N;x.bias=!(x.bias);O=true}}else{if(q===-1){if((res.elements[0][p].real>0&&(F<D))||(res.elements[0][p].real<0&&(F>D))){N=D;D=F;F=N;x.bias=!(x.bias);O=true}}else{if(p===-1){if((res.elements[0][q].real<0&&(F<D))||(res.elements[0][q].real>0&&(F>D))){N=D;D=F;F=N;x.bias=!(x.bias);O=true}}}}x.value=F;x.value_reverse=D;components[J]=x;this.cleanCircuit();this.createAMatrix();this.createZMatrix(w);aM=$M(this.AMatrix);zM=$M(this.ZMatrix);invAM=aM.inv();res=zM.x(invAM)}}}while(u===true){u=false;for(J=0,y=components.length;J<y;J++){var x=components[J];var E=x.nodes;var h=E[0];var g=E[1];var q=this.getNodeIndex(h);var p=this.getNodeIndex(g);var C;if(x.type==="Diode"){var l=this.currentSources;var n=null;var t=2;for(I=0,M=l.length;I<M;I++){if(l[I].id==x.id+"CurrentSource_CB"){t=0;n=I;break}else{if(l[I].id==x.id+"CurrentSource_CE"){t=1;n=I;break}}}if(t!=2){if(q!=-1&&p!=-1){if(((res.elements[0][q]).real-(res.elements[0][p]).real<0&&(F<D))||((res.elements[0][q]).real-(res.elements[0][p]).real>0&&(F>D))){if(t){l[n].Current=0.02*((res.elements[0][q]).real-(res.elements[0][p]).real)/D}else{l[n].Current=0.98*((res.elements[0][q]).real-(res.elements[0][p]).real)/D}}else{if(t){l[n].Current=0.02*((res.elements[0][q]).real-(res.elements[0][p]).real)/F}else{l[n].Current=0.98*((res.elements[0][q]).real-(res.elements[0][p]).real)/F}}}else{if(q===-1){if((-(res.elements[0][p]).real<0&&(F<D))||(-(res.elements[0][p]).real>0&&(F>D))){if(t){l[n].Current=0.02*-(res.elements[0][p]).real/D}else{l[n].Current=0.98*-(res.elements[0][p]).real/D}}else{if(t){l[n].Current=0.02*-(res.elements[0][p]).real/F}else{l[n].Current=0.98*-(res.elements[0][p]).real/F}}}else{if(p===-1){if(((res.elements[0][q]).real<0&&(F<D))||((res.elements[0][q]).real>0&&(F>D))){if(t){l[n].Current=0.02*(res.elements[0][q]).real/D}else{l[n].Current=0.98*(res.elements[0][q]).real/D}}else{if(t){l[n].Current=0.02*(res.elements[0][q]).real/F}else{l[n].Current=0.98*(res.elements[0][q]).real/F}}}}}}if(x.bias===false){C=x.value;if(q!=-1&&p!=-1){if(Math.abs(N-(x.value*x.dark_current*(Math.exp(((res.elements[0][q]).real-(res.elements[0][p]).real)*40)-1)))>=0.00001){while(x.dark_current*x.value*(Math.exp(40*((res.elements[0][q]).real-(res.elements[0][p]).real))-1)>=10000000000){x.value=x.value/10}N=(x.value*x.dark_current*(Math.exp(((res.elements[0][q]).real-(res.elements[0][p]).real)*40)-1));if((res.elements[0][q]).real-(res.elements[0][p]).real<0){x.value=((res.elements[0][q]).real-(res.elements[0][p]).real)/(x.dark_current*(Math.exp(40*((res.elements[0][q]).real-(res.elements[0][p]).real))-1));x.bias=false}else{x.value=0.025/x.dark_current;x.bias=true}O=true}}else{if(q===-1){if(Math.abs(N-(x.value*x.dark_current*(Math.exp((-(res.elements[0][p]).real*40)-1)))>=0.00001)){while(x.dark_current*x.value*(Math.exp(-res.elements[0][p]*40).real-1)>=10000000000){x.value=x.value/10}N=(x.value*x.dark_current*(Math.exp(-(res.elements[0][p]).real*40)-1));x.value=(-(res.elements[0][p]).real)/(x.dark_current*(Math.exp(-(res.elements[0][p]*40).real)-1));if(-(res.elements[0][p]).real>0){x.value=(-(res.elements[0][p]).real)/(x.dark_current*(Math.exp(40*(-(res.elements[0][p]).real))-1));x.bias=false}else{x.value=0.025/x.dark_current;x.bias=true}O=true}}else{if(p===-1){if(Math.abs(N-(x.value*x.dark_current*(Math.exp(((res.elements[0][q]).real*40)-1)))>=0.00001)){while(x.dark_current*x.value*(Math.exp(res.elements[0][q]*40).real-1)>=10000000000){x.value=x.value/10}N=(x.value*x.dark_current*(Math.exp((res.elements[0][q]*40).real)-1));x.value=((res.elements[0][q]).real)/(x.dark_current*(Math.exp((res.elements[0][q]*40).real)-1));if((res.elements[0][q]).real>0){x.value=((res.elements[0][q]).real)/(x.dark_current*(Math.exp(40*((res.elements[0][q]).real))-1));x.bias=false}else{x.value=0.025/x.dark_current;x.bias=true}O=true}}}}}components[J]=x;this.cleanCircuit();this.createAMatrix();this.createZMatrix(w);aM=$M(this.AMatrix);zM=$M(this.ZMatrix);invAM=aM.inv();res=zM.x(invAM);s=res}}}L.push(res);s=res;w=w+0.001/B;f=L}return L};e.prototype.getVoltageAt=function(i,l){if(i===this.referenceNode){return 0}try{var h=null;if(this.RLC){h=this.solve_RLC()}else{var g=this.solve(l);h=g[g.length-1]}return h.elements[0][this.getNodeIndex(i)].real}catch(k){return 0}};e.prototype.getVoltageAt_array=function(k,l){var h;var g=this.solve(l);var m=[];for(h=0;h<g.length;h++){if(k===this.referenceNode){m.push(0)}m.push(g[h].elements[0][this.getNodeIndex(k)].real)}return m};e.prototype.getVoltageBetween=function(h,g,i){return(this.getVoltageAt(h,i)-this.getVoltageAt(g,i))};e.prototype.getVoltageBetween_array=function(l,k,n){var h=this.getVoltageAt_array(l,n);var g=this.getVoltageAt_array(k,n);var o=[];var m=0;while(m<h.length){o.push(h[m]-g[m])}return o};e.prototype.getCurrent=function(l,k){var p,g,n=null,m,q;try{var h=this.solve(k);p=h[h.length-1]}catch(o){return 0}g=this.voltageSources;for(m=0,q=g.length;m<q;m++){if(g[m].id==l){n=m;break}}if(n===null){try{throw Error("No Voltage source "+l)}catch(o){return 0}}try{return p.elements[0][this.nodes.length-1+n].real}catch(o){return 0}};window.CiSo=e})();var Complex=function(b,a){if(!(this instanceof Complex)){return new Complex(b,a)}if(typeof b==="string"&&a===null){return Complex.parse(b)}this.real=b||0;this.imag=a||0;this.magnitude=Math.sqrt(this.real*this.real+this.imag*this.imag);this.angle=Math.atan2(this.imag,this.real)};Complex.prototype={copy:function(){return new Complex(this.real,this.imag)},add:function(a){var c,b;if(a instanceof Complex){c=a.real;b=a.imag}else{c=a;b=0}return new Complex(this.real+c,this.imag+b)},subtract:function(a){var c,b;if(a instanceof Complex){c=a.real;b=a.imag}else{c=a;b=0}return new Complex(this.real-c,this.imag-b)},multiply:function(a){var e,d,c,b;if(a instanceof Complex){e=a.real;d=a.imag}else{e=a;d=0}c=this.real*e-this.imag*d;b=this.real*d+this.imag*e;return new Complex(c,b)},divide:function(a){var f,e,b,d,c;if(a instanceof Complex){f=a.real;e=a.imag}else{f=a;e=0}b=f*f+e*e;d=(this.real*f+this.imag*e)/b;c=(this.imag*f-this.real*e)/b;return new Complex(d,c)},inverse:function(){var a=new Complex(1,0);return a.divide(this)},negative:function(){var a=new Complex(0,0);return a.subtract(this)},equals:function(a){if(a instanceof Complex){return this.real===a.real&&this.imag===a.imag}else{if(typeof a==="number"){return this.real===a&&this.imag===0}}return false},toString:function(){return this.real+"i"+this.imag}};Complex.parse=function(c){if(!c){return null}var b=/(.*)([+,\-].*i)/.exec(c),d,a;if(b&&b.length===3){d=parseFloat(b[1]);a=parseFloat(b[2].replace("i",""))}else{d=parseFloat(c);a=0}if(isNaN(d)||isNaN(a)){throw new Error("Invalid input to Complex.parse, expecting a + bi format, instead was: "+c)}return new Complex(d,a)};$Comp=function(){if(typeof arguments[0]==="string"){return Complex.parse(arguments[0])}return new Complex(arguments[0],arguments[1])};var Sylvester={version:"0.1.3-cc",precision:0.000001};function Matrix(){}Matrix.prototype={dup:function(){return Matrix.create(this.elements)},canMultiplyFromLeft:function(a){var b=a.elements||a;if(typeof(b[0][0])=="undefined"){b=Matrix.create(b).elements}return(this.elements[0].length==b.length)},multiply:function(q){if(!q.elements){return this.map(function(c){return c.multiply(q)})}var h=q.modulus?true:false;var n=q.elements||q;if(typeof(n[0][0])=="undefined"){n=Matrix.create(n).elements}if(!this.canMultiplyFromLeft(n)){return null}var e=this.elements.length,f=e,l,b,d=n[0].length,g;var p=this.elements[0].length,a=[],m,k,o;do{l=f-e;a[l]=[];b=d;do{g=d-b;m=$Comp(0,0);k=p;do{o=p-k;m=m.add(this.elements[l][o].multiply(n[o][g]))}while(--k);a[l][g]=m}while(--b)}while(--e);var n=Matrix.create(a);return h?n.col(1):n},x:function(a){return this.multiply(a)},isSquare:function(){return(this.elements.length==this.elements[0].length)},toRightTriangular:function(){var f=this.dup(),d;var b=this.elements.length,c=b,e,g,h=this.elements[0].length,a;do{e=c-b;if(f.elements[e][e].equals(0)){for(j=e+1;j<c;j++){if(!f.elements[j][e].equals(0)){d=[];g=h;do{a=h-g;d.push(f.elements[e][a].add(f.elements[j][a]))}while(--g);f.elements[e]=d;break}}}if(!f.elements[e][e].equals(0)){for(j=e+1;j<c;j++){var l=f.elements[j][e].divide(f.elements[e][e]);d=[];g=h;do{a=h-g;d.push(a<=e?$Comp(0):f.elements[j][a].subtract(f.elements[e][a].multiply(l)))}while(--g);f.elements[j]=d}}}while(--b);return f},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare()){return null}var e=this.toRightTriangular();var c=e.elements[0][0],d=e.elements.length-1,a=d,b;do{b=a-d+1;c=c.multiply(e.elements[b][b])}while(--d);return c},det:function(){return this.determinant()},isSingular:function(){return(this.isSquare()&&this.determinant().equals(0))},augment:function(l){var h=l.elements||l;if(typeof(h[0][0])=="undefined"){h=Matrix.create(h).elements}var e=this.dup(),k=e.elements[0].length;var c=e.elements.length,d=c,g,a,b=h[0].length,f;if(c!=h.length){return null}do{g=d-c;a=b;do{f=b-a;e.elements[g][k+f]=h[g][f]}while(--a)}while(--c);return e},inverse:function(){if(!this.isSquare()||this.isSingular()){return null}var c=this.elements.length,d=c,h,g;var k=this.augment(Matrix.I(c)).toRightTriangular();var l,m=k.elements[0].length,a,f,b;var n=[],e;do{h=c-1;f=[];l=m;n[h]=[];b=k.elements[h][h];do{a=m-l;e=k.elements[h][a].divide(b);f.push(e);if(a>=d){n[h].push(e)}}while(--l);k.elements[h]=f;for(g=0;g<h;g++){f=[];l=m;do{a=m-l;f.push(k.elements[g][a].subtract(k.elements[h][a].multiply(k.elements[g][h])))}while(--l);k.elements[g]=f}}while(--c);return Matrix.create(n)},inv:function(){return this.inverse()},setElements:function(h){var m,a=h.elements||h;if(typeof(a[0][0])!="undefined"){var d=a.length,f=d,b,c,l;this.elements=[];do{m=f-d;b=a[m].length;c=b;this.elements[m]=[];do{l=c-b;this.elements[m][l]=a[m][l]}while(--b)}while(--d);return this}var e=a.length,g=e;this.elements=[];do{m=g-e;this.elements.push([a[m]])}while(--e);return this}};Matrix.create=function(a){var b=new Matrix();return b.setElements(a)};Matrix.I=function(f){var e=[],a=f,d,c,b;do{d=a-f;e[d]=[];c=a;do{b=a-c;e[d][b]=(d==b)?$Comp(1,0):$Comp(0)}while(--c)}while(--f);return Matrix.create(e)};var $M=Matrix.create;